// *****************************************************************************
//  概要
//    : エントリーポイントです
//  備考
//    : 
//  ---------------------------------------------------------------------------
//  No   : 日時      : 内容
//  ---------------------------------------------------------------------------
//  1    :2024/08/16 : 初版
// *****************************************************************************

// *****************************************************************************
// ■ インクルード
// *****************************************************************************
#include "system.h"

// *****************************************************************************
// ■ グローバル変数
// *****************************************************************************

// *****************************************************************************
// ■ 関数
// *****************************************************************************

//-----------------------------------------
// 関数名　： setup
// 引数　　： -
// 戻値　　： -
// 備考　　：
//-----------------------------------------
void setup() {
  Serial.begin(SERIAL_CLOCK);
  pinMode(PIN_5, OUTPUT);

  // シリアルモニターに"Hello"を表示
  Serial.println("Hello");

  // 0番のタイマーを80MHzのクロックを使用して初期化
  g_timer = timerBegin(TIMER_HZ);
  if(g_timer == NULL)
    return;
  // タイマーの割り込みを登録
  timerAttachInterrupt(g_timer, &OnTimerCallback);
  // 1秒(1000000us)ごとにタイマーを発生させる
  timerAlarm(g_timer, TIMER_ON_CALL_INTERVAL_VALUE, true, 2);

}

//-----------------------------------------
// 関数名　： loop
// 引数　　： -
// 戻値　　： -
// 備考　　：
//-----------------------------------------
void loop() {
  static int light = OFF;

  if(g_time_100us > TIME_1S_100US)
  {
    g_time_100us = 0;
    g_time_1s++;
    light = ~light;
    digitalWrite(PIN_5, light);

    Serial.print("Power on time = ");
    Serial.println(g_time_1s);
  }

}

// *****************************************************************************
// ■ コールバック関数
// *****************************************************************************

//-----------------------------------------
// 関数名　： OnTimerCallback
// 引数　　： -
// 戻値　　： -
// 備考　　：
//-----------------------------------------
IRAM_ATTR void OnTimerCallback()
{
  g_time_100us++;
}